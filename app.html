<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UQROO Kids â€” English Academy (Completo)</title>
<meta name="description" content="Juego educativo de inglÃ©s para niÃ±os 3-8 â€” estilo UQROO Cozumel. 50 niveles, mÃºltiples minijuegos, TTS, reconocimiento, PWA-ready." />
<style>
:root{--green:#006241;--dark:#003E29;--cream:#F6FBF9;--gold:#C6A500;--accent:#00A5C4;--card:#fff;--muted:#5f7878;--radius:16px;font-family:Inter, Poppins, system-ui, -apple-system, 'Segoe UI', Roboto, Arial}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#eaf9f7,#f7fff9);color:var(--dark)}
.app{max-width:1200px;margin:20px auto;padding:18px}
header.site{display:flex;align-items:center;gap:18px;padding:18px;background:linear-gradient(90deg,var(--green),var(--accent));color:white;border-radius:14px}
.logo{display:flex;align-items:center;gap:12px}
.logo .mark{width:64px;height:64px;border-radius:12px;background:var(--cream);display:flex;align-items:center;justify-content:center;color:var(--green);font-weight:800}
.layout{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:16px}
.sidebar{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
.profile{display:flex;gap:12px;align-items:center}
.avatar{width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--green));color:white;display:flex;align-items:center;justify-content:center;font-weight:800}
.stats{margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
.stat{background:linear-gradient(180deg,rgba(255,255,255,0.7),#fff);padding:10px;border-radius:10px;text-align:center}
.progress-bar{height:12px;background:#e6f6f9;border-radius:10px;overflow:hidden}
.progress-bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--gold),var(--accent));width:0%}
.stage{background:linear-gradient(180deg,#fff,#f6fffe);padding:16px;border-radius:12px;min-height:640px;box-shadow:0 8px 30px rgba(0,0,0,0.05)}
.grid-2{display:grid;grid-template-columns:1fr 360px;gap:14px}
.card{background:var(--card);padding:12px;border-radius:12px}
.controls{display:flex;gap:10px;align-items:center}
.btn{background:var(--green);color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 12px;border-radius:10px}
.choices{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.choice{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#f7fffe);border:2px solid transparent;cursor:pointer;font-weight:700}
.choice:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.06)}
.choice.correct{border-color:green;background:linear-gradient(90deg,#e6fff1,#d9fff3)}
.choice.wrong{border-color:#f48a8a;background:linear-gradient(90deg,#fff2f2,#fff4f4)}
.game-hub{display:flex;flex-direction:column;gap:12px}
.game-btn{padding:14px;border-radius:12px;border:none;cursor:pointer;font-weight:800}
.mem-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.mem-card{background:var(--accent);color:white;padding:18px;border-radius:10px;text-align:center;font-size:18px;cursor:pointer}
.level-selector{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.level-btn{padding:10px;border-radius:10px;background:linear-gradient(90deg,var(--green),var(--accent));color:white;cursor:pointer}
.map{background:linear-gradient(180deg,#fffef7,#f0fff8);padding:12px;border-radius:12px}
.badge{display:inline-block;background:var(--gold);padding:6px 10px;border-radius:999px;color:#012; font-weight:800}
.small{font-size:13px;color:var(--muted)}
@media(max-width:980px){.layout{grid-template-columns:1fr}.grid-2{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app">
  <header class="site">
    <div class="logo"><div class="mark">UQ</div><div><h1>UQROO Kids â€” English Academy</h1><div class="small">50 niveles â€¢ MÃºltiples juegos â€¢ Progreso y revisiÃ³n</div></div></div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <button id="saveBtn" class="btn">Guardar</button>
      <button id="resetBtn" class="btn-ghost">Reset</button>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="profile"><div class="avatar" id="avatar">K</div><div><div id="playerName" style="font-weight:800">Invitado</div><div class="small">Nivel: <strong id="currentLevel">1</strong></div></div></div>
      <div class="stats"><div class="stat"><div class="small">Monedas</div><div id="coins" style="font-weight:900;color:var(--gold);font-size:18px">0</div></div><div class="stat"><div class="small">XP</div><div id="xp" style="font-weight:900;color:var(--accent);font-size:18px">0 XP</div></div></div>
      <div style="margin-top:12px"><div class="small">Progreso General</div><div class="progress-bar" style="margin-top:6px"><i id="globalProgress"></i></div></div>
      <div style="margin-top:10px"><div class="small" style="font-weight:800">Tienda</div><div id="shop" style="margin-top:8px"></div></div>
      <div style="margin-top:12px"><div class="small" style="font-weight:800">Logros</div><div id="badges" style="margin-top:8px">â€”</div></div>
    </aside>

    <main class="stage">
      <div class="grid-2">
        <section class="card">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div><div class="small">LecciÃ³n</div><div style="font-weight:900;font-size:20px" id="levelNum">1</div></div>
            <div class="small">Monedas por completar: <strong id="reward">10</strong></div>
          </div>

          <div style="margin-top:12px" id="mainArea">
            <!-- AquÃ­ se cargan dinÃ¡micamente los juegos -->
            <div class="game-hub">
              <button class="game-btn" onclick="location.href='listenandselect.html'" id="btn_listen" style="background:linear-gradient(90deg,var(--gold),var(--accent));">ğŸ”Š Listen & Select</button>
Â  Â  Â  Â  Â  Â  Â  
<button class="game-btn" onclick="location.href='memorama.html'" id="btn_memorama" style="background:linear-gradient(90deg,#ffb347,#ffcc33);">ğŸ´ Memorama</button>
Â  Â  Â  Â  Â  Â  Â  
<button class="game-btn" onclick="location.href='ordenar_letras.html'" id="btn_order" style="background:linear-gradient(90deg,#6ec1ff,#4da6ff);">ğŸ”¤ Ordenar Letras</button>
Â  Â  Â  Â  Â  Â  Â  
<button class="game-btn" onclick="location.href='completar_palabra.html'" id="btn_complete" style="background:linear-gradient(90deg,#b9ffb3,#6cff8c);">âœï¸ Completar Palabra</button>

<button class="game-btn" onclick="location.href='mapa_aventuras.html'" id="btn_map" style="background:linear-gradient(90deg,var(--green),var(--accent));">ğŸ—ºï¸ Mapa â€” Aventuras</button>

            </div>
          </div>

        </section>

        <aside class="card">
          <div style="font-weight:800">InformaciÃ³n rÃ¡pida</div>
          <div style="margin-top:8px" id="infoBox">Selecciona un juego para comenzar. Usa el micrÃ³fono para practicar pronunciaciÃ³n.</div>
          <div style="margin-top:12px" class="small">Controles</div>
          <div style="margin-top:6px;display:flex;gap:6px"><button id="playTTS" class="btn-ghost">Probar TTS</button><button id="recBtn" class="btn">Probar micrÃ³fono</button></div>
          <div style="margin-top:12px" class="small">Dificultad</div>
          <div style="margin-top:8px;display:flex;gap:8px"><button class="btn-ghost" id="dif_easy">FÃ¡cil</button><button class="btn-ghost" id="dif_med">Medio</button><button class="btn-ghost" id="dif_hard">DifÃ­cil</button></div>
        </aside>
      </div>

      <div style="margin-top:12px" class="card map" id="mapArea">
        <div style="font-weight:800">Mapa de Aventuras</div>
        <div style="margin-top:8px">Desbloquea edificios completando lecciones. Cada 10 niveles desbloquea una nueva zona.</div>
        <div id="mapTiles" style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap"></div>
      </div>

      <footer style="margin-top:10px" class="small">DiseÃ±ado para edades 3â€“8 â€¢ EstÃ©tica UQROO Campus Cozumel â€¢ Contenido modular y seguro</footer>
    </main>
  </div>
</div>

<script>
// =====================
// DATOS Y ESTADO
// =====================
const TOTAL_LEVELS = 50;
const state = {
  name: localStorage.getItem('uq_name')||'Invitado',
  level: Number(localStorage.getItem('uq_level'))||1,
  coins: Number(localStorage.getItem('uq_coins'))||0,
  xp: Number(localStorage.getItem('uq_xp'))||0,
  streak: Number(localStorage.getItem('uq_streak'))||0,
  completed: Number(localStorage.getItem('uq_completed'))||0,
  badges: JSON.parse(localStorage.getItem('uq_badges')||'[]'),
  difficulty: localStorage.getItem('uq_diff')||'easy',
  spaced: JSON.parse(localStorage.getItem('uq_spaced')||'{}') // for spaced repetition
};

const POOLS = {
  1:['cat','dog','ball','sun','milk'],
  2:['apple','car','book','hat','bird'],
  3:['house','tree','cup','shoe','door'],
  4:['red','blue','green','big','small'],
  5:['eat','run','sleep','play','jump']
};

// Utility
function saveAll(){ localStorage.setItem('uq_level',state.level); localStorage.setItem('uq_coins',state.coins); localStorage.setItem('uq_xp',state.xp); localStorage.setItem('uq_streak',state.streak); localStorage.setItem('uq_completed',state.completed); localStorage.setItem('uq_badges',JSON.stringify(state.badges)); localStorage.setItem('uq_name',state.name); localStorage.setItem('uq_diff',state.difficulty); localStorage.setItem('uq_spaced',JSON.stringify(state.spaced)); renderHeader(); }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; }
function computeReward(lvl){ return Math.max(8,Math.floor(8 + lvl*0.6)); }
function difficultyLabel(){ if(state.difficulty==='easy')return 'FÃ¡cil'; if(state.difficulty==='med')return 'Medio'; return 'DifÃ­cil'; }

// Header & UI refs
const refs = {
  levelNum: document.getElementById('levelNum'), currentLevel: document.getElementById('currentLevel'), coins: document.getElementById('coins'), xp: document.getElementById('xp'), globalProgress: document.getElementById('globalProgress'), reward: document.getElementById('reward'), infoBox: document.getElementById('infoBox'), shop: document.getElementById('shop'), badges: document.getElementById('badges'), mapTiles: document.getElementById('mapTiles')
};

function renderHeader(){ refs.levelNum.textContent = state.level; refs.currentLevel.textContent = state.level; refs.coins.textContent = state.coins; refs.xp.textContent = state.xp + ' XP'; refs.badges.textContent = state.badges.length? state.badges.join(', '):'â€”'; refs.globalProgress.style.width = Math.round((state.completed/TOTAL_LEVELS)*100) + '%'; refs.reward.textContent = computeReward(state.level); }

// Init
renderHeader(); renderShop(); renderMap();

// =====================
// SHOP
// =====================
const shopItems = [{id:'bg1',name:'Fondo Cozumel',cost:50,apply:()=>document.body.style.background='linear-gradient(180deg,#e9fbff,#f2fff7)'},{id:'bg2',name:'Noche Tropical',cost:70,apply:()=>document.body.style.background='linear-gradient(180deg,#012d3d,#00151b)'}];
function renderShop(){ refs.shop.innerHTML=''; shopItems.forEach(it=>{ const d=document.createElement('div'); d.className='card'; d.style.marginTop='8px'; d.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${it.name}</strong><div class="small">${it.cost} ğŸª™</div></div><div><button class="btn-ghost">Comprar</button></div></div>`; refs.shop.appendChild(d); d.querySelector('button').addEventListener('click',()=>{ if(state.coins < it.cost) return alert('No tienes suficientes monedas'); state.coins -= it.cost; it.apply(); saveAll(); }); }); }

// =====================
// MAP / AVENUES
// =====================
function renderMap(){ refs.mapTiles.innerHTML=''; for(let i=1;i<=5;i++){ const tile=document.createElement('div'); tile.className='card'; tile.style.minWidth='160px'; tile.innerHTML=`<div style="font-weight:800">Zona ${i}</div><div class="small">Niveles ${(i-1)*10+1} - ${i*10}</div><div style="margin-top:8px">${ state.completed >= i*10 ? '<span class="badge">Desbloqueada</span>' : '<span class="small">Bloqueada</span>' }</div>`; refs.mapTiles.appendChild(tile); } }

// =====================
// GAMES
// =====================
// Helper to pick items for current level
function getPool(level){ if(level<=5) return POOLS[level]; let arr=[]; Object.values(POOLS).forEach(a=>arr=arr.concat(a)); arr = arr.concat(['dance','swim','listen','draw','count','smile']); return shuffle(arr).slice(0,Math.min(30,6+Math.floor(level*0.6))); }

// 1) Listen & Select
function launchListen(){ refs.infoBox.textContent = 'Actividad: Escucha y selecciona. Estilo auditivo para practicar pronunciaciÃ³n.'; const pool=getPool(state.level); const correct = pool[Math.floor(Math.random()*pool.length)]; const options = new Set([correct]); while(options.size<4) options.add(pool[Math.floor(Math.random()*pool.length)]); const items=shuffle(Array.from(options)); const mainArea = document.getElementById('mainArea'); mainArea.innerHTML = `<div><div style="font-weight:800">Escucha y selecciona</div><div class="small">Escucha, luego elige la palabra correcta.</div><div style="margin-top:10px"><button id="playWord" class="btn">ğŸ”Š Escuchar</button></div><div id="choices" class="choices"></div><div style="margin-top:12px"><button id="finishBtn" class="btn">Finalizar</button></div></div>`; const choicesDiv=document.getElementById('choices'); items.forEach(it=>{ const c=document.createElement('div'); c.className='choice'; c.textContent=it; c.dataset.value=it; c.addEventListener('click',()=>{ if(c.classList.contains('correct')||c.classList.contains('wrong'))return; if(it===correct){ c.classList.add('correct'); state.coins+=2; state.xp+=5; } else { c.classList.add('wrong'); state.xp+=1; Array.from(choicesDiv.children).forEach(ch=>{ if(ch.dataset.value===correct) ch.classList.add('correct'); }); } renderHeader(); }); choicesDiv.appendChild(c); }); document.getElementById('playWord').addEventListener('click',()=> speak(correct)); document.getElementById('finishBtn').addEventListener('click',()=>{ const hadCorrect = Array.from(choicesDiv.children).some(c=>c.classList.contains('correct')); if(hadCorrect){ const reward=computeReward(state.level); state.coins+=reward; state.xp+=Math.floor(reward/2); state.completed++; state.level = Math.min(TOTAL_LEVELS, state.level+1); state.streak++; if(state.streak%5===0) state.badges.push('Racha '+state.streak); saveAll(); alert('Â¡LecciÃ³n completada! Ganaste '+reward+' monedas.'); } else { if(confirm('No hubo respuestas correctas. Avanzar con -3 monedas?')){ state.coins=Math.max(0,state.coins-3); state.level=Math.min(TOTAL_LEVELS, state.level+1); state.completed++; state.streak=0; saveAll(); } }
 renderHeader(); launchListen(); }); }

// 2) Memorama
function launchMemorama(){ refs.infoBox.textContent='Memorama: encuentra las parejas iguales. Muy Ãºtil para memoria visual.'; const pool = getPool(state.level).slice(0,6); const pairs = shuffle([...pool,...pool]); const mainArea=document.getElementById('mainArea'); mainArea.innerHTML = `<div><div style="font-weight:800">Memorama</div><div class="small">Toca las cartas para encontrar parejas.</div><div id="memGrid" class="mem-grid" style="margin-top:10px"></div><div style="margin-top:12px"><button id="finishMem" class="btn">Terminar</button></div></div>`; const grid=document.getElementById('memGrid'); let first=null,second=null,lock=false,matches=0; pairs.forEach(word=>{ const c=document.createElement('div'); c.className='mem-card'; c.textContent='?'; c.dataset.word=word; c.addEventListener('click',()=>{ if(lock||c.classList.contains('matched')||c===first) return; c.textContent=word; if(!first){ first=c; } else { second=c; lock=true; if(first.dataset.word===second.dataset.word){ first.classList.add('matched'); second.classList.add('matched'); matches++; state.coins+=3; state.xp+=5; lock=false; first=null; second=null; if(matches===pool.length){ alert('ğŸ‰ Â¡Completaste el memorama!'); } } else { setTimeout(()=>{ first.textContent='?'; second.textContent='?'; lock=false; first=null; second=null; },800); } renderHeader(); } }); grid.appendChild(c); }); document.getElementById('finishMem').addEventListener('click',()=>{ state.completed++; state.level=Math.min(TOTAL_LEVELS,state.level+1); saveAll(); renderHeader(); launchMemorama(); }); }

// 3) Ordenar letras (Drag & Drop)
function launchOrder(){ refs.infoBox.textContent='Ordenar letras: arrastra para formar la palabra correcta.'; const pool = getPool(state.level); const word = pool[Math.floor(Math.random()*pool.length)]; const mainArea=document.getElementById('mainArea'); mainArea.innerHTML = `<div><div style="font-weight:800">Ordenar Letras</div><div class="small">Arrastra las letras en el orden correcto.</div><div id="letters" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap"></div><div id="drop" style="margin-top:12px;padding:10px;border:2px dashed #ddd;border-radius:8px;min-height:60px"></div><div style="margin-top:12px"><button id="checkOrder" class="btn">Comprobar</button></div></div>`; const lettersDiv=document.getElementById('letters'); const drop=document.getElementById('drop'); const letters=shuffle(word.split('')); letters.forEach(ch=>{ const b=document.createElement('div'); b.className='card'; b.style.display='inline-block'; b.style.padding='12px'; b.style.cursor='grab'; b.draggable=true; b.textContent=ch; b.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', ch); }); lettersDiv.appendChild(b); }); drop.addEventListener('dragover',e=>e.preventDefault()); drop.addEventListener('drop',e=>{ e.preventDefault(); const ch=e.dataTransfer.getData('text/plain'); const s=document.createElement('span'); s.style.marginRight='6px'; s.style.fontWeight='800'; s.textContent=ch; drop.appendChild(s); }); document.getElementById('checkOrder').addEventListener('click',()=>{ const formed = Array.from(drop.children).map(n=>n.textContent).join(''); if(formed===word){ alert('âœ… Correcto!'); state.coins+=8; state.xp+=10; state.completed++; state.level=Math.min(TOTAL_LEVELS,state.level+1); saveAll(); } else alert('Intenta otra vez: ' + formed); renderHeader(); launchOrder(); }); }

// 4) Completar palabra (tipo fill-in)
function launchComplete(){ refs.infoBox.textContent='Completar palabra: escribe la palabra faltante.'; const pool=getPool(state.level); const word=pool[Math.floor(Math.random()*pool.length)]; const masked = word[0] + '_'.repeat(Math.max(1, word.length-2)) + word[word.length-1]; const mainArea=document.getElementById('mainArea'); mainArea.innerHTML = `<div><div style="font-weight:800">Completar palabra</div><div class="small">Escribe la palabra que falta.</div><div style="margin-top:10px;font-size:26px;font-weight:900">${masked}</div><div style="margin-top:10px"><input id="txtInput" placeholder="Escribe aquÃ­" style="padding:10px;border-radius:8px;border:1px solid #ddd;width:60%"/></div><div style="margin-top:12px"><button id="checkFill" class="btn">Comprobar</button></div></div>`; document.getElementById('checkFill').addEventListener('click',()=>{ const v=document.getElementById('txtInput').value.trim().toLowerCase(); if(v===word){ alert('Â¡Perfecto!'); state.coins+=10; state.xp+=12; state.completed++; state.level=Math.min(TOTAL_LEVELS,state.level+1); saveAll(); } else alert('No coincide, intenta de nuevo.'); renderHeader(); launchComplete(); }); }

// 5) Carrera RÃ¡pida (timed challenge)
function launchRace(){ refs.infoBox.textContent='Carrera RÃ¡pida: responde tantas palabras correctas como puedas en 30s.'; const pool=getPool(state.level); let timeLeft=30,score=0; const mainArea=document.getElementById('mainArea'); mainArea.innerHTML = `<div><div style="font-weight:800">Carrera RÃ¡pida</div><div class="small">Tiempo: <span id="raceTime">30</span>s â€¢ PuntuaciÃ³n: <span id="raceScore">0</span></div><div id="raceArea" style="margin-top:12px"></div></div>`; const raceArea=document.getElementById('raceArea'); function next(){ if(timeLeft<=0) return finish(); const correct = pool[Math.floor(Math.random()*pool.length)]; const options=new Set([correct]); while(options.size<4) options.add(pool[Math.floor(Math.random()*pool.length)]); const items=shuffle(Array.from(options)); raceArea.innerHTML = `<div style="font-weight:700;margin-bottom:8px">Escucha y selecciona</div><div style="margin-top:6px"><button id="playR" class="btn">ğŸ”Š</button></div><div id="raceChoices" class="choices" style="margin-top:8px"></div>`; const rc=document.getElementById('raceChoices'); items.forEach(it=>{ const c=document.createElement('div'); c.className='choice'; c.textContent=it; c.addEventListener('click',()=>{ if(it===correct){ score++; state.coins+=2; state.xp+=3; document.getElementById('raceScore').textContent = score; next(); } else { timeLeft -=4; document.getElementById('raceTime').textContent = timeLeft; next(); } renderHeader(); }); rc.appendChild(c); }); document.getElementById('playR').addEventListener('click',()=> speak(correct)); }
 function tick(){ timeLeft--; document.getElementById('raceTime').textContent = timeLeft; if(timeLeft<=0) finish(); }
 function finish(){ clearInterval(timer); alert('Â¡Tiempo! Puntaje: '+score); state.completed++; state.level=Math.min(TOTAL_LEVELS,state.level+1); state.coins+= Math.floor(score*3); saveAll(); renderHeader(); }
 next(); const timer = setInterval(tick,1000); }

// TTS & mic test
function speak(text){ if('speechSynthesis' in window){ const u=new SpeechSynthesisUtterance(text); u.lang='en-US'; u.rate=0.95; u.pitch=1; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); } else alert('TTS no soportado'); }

// Event bindings
document.getElementById('btn_listen').addEventListener('click', launchListen);
document.getElementById('btn_memorama').addEventListener('click', launchMemorama);
document.getElementById('btn_order').addEventListener('click', launchOrder);
document.getElementById('btn_complete').addEventListener('click', launchComplete);
document.getElementById('btn_race').addEventListener('click', launchRace);
document.getElementById('btn_map').addEventListener('click', ()=>{ document.getElementById('infoBox').textContent='Mapa: recorre las zonas desbloqueadas. Completa lecciones para avanzar.'; renderMap(); });
document.getElementById('btn_levels').addEventListener('click', ()=>{ renderLevelSelector(); });

// difficulty buttons
document.getElementById('dif_easy').addEventListener('click', ()=>{ state.difficulty='easy'; saveAll(); alert('Dificultad: FÃ¡cil'); });
document.getElementById('dif_med').addEventListener('click', ()=>{ state.difficulty='med'; saveAll(); alert('Dificultad: Medio'); });
document.getElementById('dif_hard').addEventListener('click', ()=>{ state.difficulty='hard'; saveAll(); alert('Dificultad: DifÃ­cil'); });

// mic test
document.getElementById('recBtn').addEventListener('click', async ()=>{
  if(!navigator.mediaDevices) return alert('No compatible');
  try{ const s = await navigator.mediaDevices.getUserMedia({audio:true}); alert('MicrÃ³fono OK â€” ahora puedes usar el botÃ³n de grabaciÃ³n dentro de actividades que lo soporten'); s.getTracks().forEach(t=>t.stop()); }catch(e){ alert('Error mic: '+e.message); }
});

// Level selector & spaced repetition
function renderLevelSelector(){ const mainArea=document.getElementById('mainArea'); mainArea.innerHTML = `<div><div style="font-weight:800">Seleccionar nivel</div><div class="level-selector" id="lvlSel" style="margin-top:10px"></div></div>`; const sel=document.getElementById('lvlSel'); for(let i=1;i<=TOTAL_LEVELS;i++){ const b=document.createElement('button'); b.className='level-btn'; b.textContent='Nivel '+i; b.addEventListener('click',()=>{ state.level=i; saveAll(); alert('Nivel '+i+' seleccionado'); }); sel.appendChild(b); } }

// Map unlock helper
function unlockByProgress(){ for(let i=1;i<=5;i++){ if(state.completed >= i*10){ if(!state.badges.includes('Zona'+i)) state.badges.push('Zona'+i); } } saveAll(); renderMap(); }

// Render map initially
unlockByProgress();

// Level selector on load small
function renderLevelSelectorQuick(){ /* nothing */ }

// reset & save
document.getElementById('saveBtn').addEventListener('click', ()=>{ saveAll(); alert('Guardado'); });
document.getElementById('resetBtn').addEventListener('click', ()=>{ if(!confirm('Resetear progreso?')) return; localStorage.clear(); location.reload(); });

// Start with Listen by default
launchListen();

// Expose state for debug
window._uq_state = state;
</script>
</body>
</html>